##############################################################################
# Release Pipeline
#
# Mirrors: terraform-ibm-modules/terraform-ibm-powervs-oracle
# Target:  nava-dba/terraform-ibm-oracle-powervs-da
#
# Triggers:
#   - Push (merge) to the main branch only
#   - Manual dispatch from Actions tab
#
# What it does:
#   - Runs semantic-release to:
#       * Analyze commit messages (Conventional Commits)
#       * Bump version (major/minor/patch)
#       * Generate / update CHANGELOG.md
#       * Create a GitHub Release with release notes
#       * Push a git tag (e.g. v1.2.3)
#
# Required repository secrets (Settings → Secrets → Actions):
#   GH_TOKEN   A GitHub Personal Access Token with `repo` scope.
#              (The default GITHUB_TOKEN cannot push tags back to the repo.)
##############################################################################
name: Release-Pipeline

on:
  push:
    branches:
      - main
  workflow_dispatch: # Allow manual trigger

jobs:
  call-release-pipeline:
    # -------------------------------------------------------------------
    # Calls the shared reusable release workflow maintained by terraform-ibm-modules.
    # Pin to a specific release tag for stability; Renovate will bump this.
    # -------------------------------------------------------------------
    uses: terraform-ibm-modules/common-pipeline-assets/.github/workflows/common-release-pipeline.yml@v1.24.2
    secrets: inherit
